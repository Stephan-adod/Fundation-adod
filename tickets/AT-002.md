# AT-002: Improve Execution Prompt Output

## Business Value
Execution-Prompts erzeugen aktuell uneinheitliche, teils CI-inkompatible Outputs → hohe Operator-Nacharbeit und Verzögerungen. Ziel ist ein präziser, konsistenter, repo-fertiger Output (Markdown/Code), der CI stabil passiert.

## Ziel
- Konsistente, CI-kompatible Prompt-Outputs (UTF-8, BOM-frei, markdownlint/prettier-konform).
- Operator-Nacharbeit um ~50 % reduzieren.
- Saubere Artefakt-Verknüpfung (Loops, Systemkarte) + evidenzbasierte Nachweise.
- Langfristig: Automatisierung, Governance, Feedback-Loops im Standardprozess.

## Abhängigkeiten
- AT-001 (Health-Check-Script) grün.
- Funktionierende CI-Pipeline (Lint/Format/Test/Docs/Changelog).
- Aktiver Codex Processing Loop.

## DoR (Definition of Ready)
- Zielbild, Abhängigkeiten und Scope dokumentiert.
- Aktueller CI-Status der Basis-Branch ist grün.
- One-Click Meta-Prompt verfügbar (Variante B).

## DoD (Definition of Done)
- Execution-Prompt liefert konsistent repo-fertige Artefakte (Markdown/Code) **ohne** manuelle Nachbearbeitung.
- CI (Lint/Format/Test/Docs/Changelog) in PR-Runs grün.
- Artefakte: UTF-8, BOM-frei, markdownlint-kompatibel; keine doppelten Leerzeilen.
- Gewählte Lösungsvariante (A oder B) dokumentiert + Begründung.
- Evidence: Beispiel-Run + grüner CI im PR dokumentiert (Screens/Logs).
- **Automatisierungsschritt** enthalten (z. B. CLI-Wrapper/Workflow zum Ausführen von Checks).
- **Governance-Check** integriert (z. B. Ticket-Validator für DoR/DoD, Namenskonvention).
- **Feedback-Loop** erfasst (automatisches/semi-automatisches Loop-Log mit Input/Output/CI-Ergebnis).

## Lösungsvarianten
### Variante A – Modularisierte Prompt-Templates
- Dedizierte Templates pro Artefakt-Typ (Ticket, Artefakt, Code, Docs).
- CI-Kompatibilität in Prompt-Instruktionen verankert.
- **Pro:** sehr robust/erklärbar. **Contra:** höherer Pflegeaufwand.
### Variante B – Meta-Prompt mit dynamischem Routing
- Zentraler Meta-Prompt, der je nach Parameter Ticket/Code/Docs/Artefakt erzeugt.
- **Pro:** schnell, wenig Redundanz. **Contra:** sensibler bei Spezialfällen.

## Handlungsempfehlung
- Kurzfristig (Phase 0/1): Start mit **Variante B** (Meta-Prompt) zur Beschleunigung.
- Mittelfristig (Phase 2+): Übergang auf **Variante A** für harte Governance.

## Verbesserungsfelder (verbindlich umzusetzen)
1) **Automatisierung** – Mini-Pipeline/CLI für Checks & Generierung.
2) **Governance** – Automatisierter DoR/DoD-Ticket-Validator + Namens-/Pfad-Linting.
3) **Feedback-Loop** – Auto-Loop-Log (JSONL) mit Input/Output/CI-Resultat.

## Scope (In)
- Prompt-Design, Code- und Docs-Output, CI-Konformität, Validator-Scripts, Loop-Logging.
## Scope (Out)
- Vollautomatisches Mergen, Release-Automation, produktive Deployment-Pipelines.

## Risiken & Mitigation
- **Prompt-Drift** → Versionierte Templates; Tests pro Artefakt-Typ.
- **CI-Flakes** → deterministische lokale Checks (Node-Scripts) vor Push.
- **Over-Engineering** → klare Milestones (M1–M3) und Abbruchkriterien.

## Milestones
- **M1:** Meta-Prompt B aktiv + Governance/UTF-8-Checks lokal (Node-Scripts).
- **M2:** Ticket-Validator + Loop-Log integriert; PR-Workflow ruft Checks.
- **M3:** Review-Guidelines + Entscheidungsvorlage A→B.

## Testfälle (stichpunktartig)
- Ticket mit korrektem Titelmuster `AT-###: <title>` besteht Validator.
- Markdown-Artefakt mit doppelten Leerzeilen fällt durch, wird gefixt.
- Beispiel-Run erzeugt Loop-Log-Eintrag mit CI-Status `success`.
